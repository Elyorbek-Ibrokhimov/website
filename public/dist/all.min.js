"use strict";function dataProperties(e,t){for(var a=[],s=0;s<e.length;s++)a.push(e[s][t]);return a}function postData(e,t){var a=new XMLHttpRequest;a.open("POST","/instruments/prices"),a.send(e),a.onload=function(){if(200!==a.status)console.log("error");else if(200===a.status){var e=function(){function e(e){a.push(Math.round(100*e)/100)}function t(){return Math.pow(10,4)*(c[s]-o[s])}for(var a=[],s=0;s<n.length;s++){var i=t();e(i)}return a},s=JSON.parse(a.responseText),i=JSON.parse(s.body).prices,n=t,c=dataProperties(i,"ask"),o=dataProperties(i,"bid"),r=e(),l=React.createElement(dataCells,{nameList:n,askList:c,bidList:o,spreadList:r});ReactDOM.render(l,document.getElementById("data-table"))}}}function gatherInstruments(){var e=new XMLHttpRequest;e.onerror=function(){console.log("gather error")},e.onload=function(){var t=JSON.parse(e.responseText),a=t[0].instrument;(function(){for(var e=1;e<t.length;e++)a+="%2C"+t[e].instrument})();postData(a,t)},e.open("GET","/instruments",!0),e.send()}function switchPages(e){e.preventDefault();for(var t=(document.getElementById("navigation"),document.getElementsByClassName("page")),a=0;a<t.length;a++)e.target.getAttribute("data-page")===t[a].getAttribute("data-page")?(t[a].classList.add("show"),t[a].classList.remove("hidden")):(t[a].classList.remove("show"),t[a].classList.add("hidden"))}function historyToggle(){$(document).ready(function(){$("#history-table").slideToggle(),$("#data-table").slideToggle()})}function filterByName(e){var t=document.getElementsByClassName("cell");_.each(t,function(t){"hideAll"===e?console.log(e):t.getAttribute("data-filter")===e&&t.classList.toggle("hidden")})}function getHistory(e,t){function a(){i&&(i.textContent=""),document.getElementById("graph")||c.appendChild(n)}var s=new XMLHttpRequest,i=document.getElementById("history-help"),n=document.createElement("img"),c=document.getElementById("history-table");n.setAttribute("id","history-load-icon"),n.setAttribute("src","../images/loading.gif"),s.addEventListener("loadstart",a),s.open("POST","/instruments/history"),s.send(e),s.onload=function(){var e=React.createElement(historyData,{displayName:t});responseObject=JSON.parse(s.responseText),dateList=responseObject.candles,ReactDOM.render(e,document.getElementById("history-table")),drawChart(dateList)}}function drawChart(e){var t=function(){for(var t=[],a=0;a<e.length;a++)t.push([e[a].time.slice(0,10),e[a].lowBid,e[a].openBid,e[a].closeBid,e[a].highBid]);return t}(),a=google.visualization.arrayToDataTable(t,!0),s={legend:"none",height:500,backgroundColor:{fill:"none"},width:2200,fallingColor:{strokeWidth:0,color:"#a52714"},risingColor:{strokeWidth:0,color:"#0f9d58"}},i=new google.visualization.CandlestickChart(document.getElementById("graph"));i.draw(a,s)}var cell=React.createClass({openHistory:function(){var e=(document.getElementById("history-table").getAttribute("style"),this.props.name),t=e.slice(0,3),a=e.slice(4,8),s=t+"_"+a;historyToggle(),getHistory(s,e)},highlight:function(e){var t=document.getElementById("history-table").getAttribute("style"),a=document.getElementsByClassName("select-box");_.each(a,function(e){e.classList.remove("highlight")}),"display: block;"!==t&&highlightToggle(),this.openHistory()},componentWillReceiveProps:function(e){var t=e.spread,a=this.props.spread,s=this.spreadCell;a!==t&&a>t?(s.classList.remove("show-decrease"),s.classList.add("show-increase"),s.classList.remove("show-no-change")):a!==t&&t>a?(s.classList.remove("sh√üow-increase"),s.classList.add("show-decrease"),s.classList.remove("show-no-change")):(s.classList.add("show-no-change"),s.classList.remove("show-increase"),s.classList.remove("show-decrease"))},propTypes:{displayName:React.PropTypes.string,bid:React.PropTypes.number,ask:React.PropTypes.number,spread:React.PropTypes.number},render:function(){var e=this,t=this.props.name.slice(0,3),a=this.props.name.slice(4,8);return React.DOM.div({},React.DOM.div({className:"flags"},React.DOM.div({className:t.toLowerCase()}),React.DOM.div({className:a.toLowerCase()})),React.DOM.div({className:"display-name"},this.props.name),React.DOM.div({className:"bid-ask-prices"},React.DOM.div({className:"bid-price"},"bid: "+this.props.bid),React.DOM.div({className:"ask-price"},"ask: "+this.props.ask)),React.DOM.div({className:"spread",ref:function(t){return e.spreadCell=t}},this.props.spread),React.DOM.input({value:"History",type:"button",className:"history-button",onClick:this.openHistory}))}}),dataCells=React.createClass({getInitialState:function(){return{eurChecked:!0,usdChecked:!0,gbpChecked:!0,chfChecked:!0,audChecked:!0,cadChecked:!0,nzdChecked:!0}},filter:function(e){var t=e.target.getAttribute("id"),a=t.slice(0,3);filterByName(a)},deselect:function(e){},render:function(){var e=this.props.bidList,t=this.props.bidList,a=this.props.spreadList,s=this.props.nameList.map(function(s,i){var n=React.createElement(cell,{name:s.displayName,bid:e[i],ask:t[i],spread:a[i]});return React.createElement("div",{className:"cell",key:i,"data-filter":s.displayName.slice(0,3).toLowerCase()},n)});return React.createElement("div",{id:"cell-list"},React.DOM.div({id:"filters"},React.DOM.label({},React.DOM.input({type:"checkbox",id:"eurChecked",onChange:this.filter,defaultChecked:this.state.eurChecked}),React.DOM.span({},"EUR")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"usdChecked",onChange:this.filter,defaultChecked:this.state.usdChecked}),React.DOM.span({},"USD")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"gbpChecked",onChange:this.filter,defaultChecked:this.state.gbpChecked}),React.DOM.span({},"GBP")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"chfChecked",onChange:this.filter,defaultChecked:this.state.chfChecked}),React.DOM.span({},"CHF")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"audChecked",onChange:this.filter,defaultChecked:this.state.audChecked}),React.DOM.span({},"AUD")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"cadChecked",onChange:this.filter,defaultChecked:this.state.cadChecked}),React.DOM.span({},"CAD")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"nzdChecked",onChange:this.filter,defaultChecked:this.state.nzdChecked}),React.DOM.span({},"NZD"))),s)}});setInterval(gatherInstruments,2e3),$(document).ready(function(){$("#history-button").click(function(){$("#history-table").slideToggle()})});var eachCell=document.getElementsByClassName("cell");console.log(eachCell);var historyData=React.createClass({closeHistory:function(){historyToggle()},propTypes:{displayName:React.PropTypes.string},render:function(){var e=this.props.displayName.slice(0,3),t=this.props.displayName.slice(4,8);return React.DOM.div({id:"history-info"},React.DOM.h3({className:"history-instrument"},this.props.displayName),React.DOM.div({onClick:this.closeHistory,className:"graph-close"},React.DOM.input({type:"button",className:"close-button",value:"Close"}),React.DOM.i({className:"glyphicon glyphicon-remove close-arrow"})),React.DOM.div({className:"graph-flag"},React.DOM.div({className:e.toLowerCase()}),React.DOM.div({className:t.toLowerCase()})),React.DOM.div({id:"graph"}))}});