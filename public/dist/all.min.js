"use strict";function dataProperties(e,t){for(var s=[],a=0;a<e.length;a++)s.push(e[a][t]);return s}function postData(e,t){var s=new XMLHttpRequest;s.open("POST","/instruments/prices"),s.send(e),s.onload=function(){if(200!==s.status)console.log("error");else if(200===s.status){var e=function(){function e(e){s.push(Math.round(100*e)/100)}function t(){return Math.pow(10,4)*(r[a]-l[a])}for(var s=[],a=0;a<n.length;a++){var i=t();e(i)}return s},a=JSON.parse(s.responseText),i=JSON.parse(a.body).prices,n=t,r=dataProperties(i,"ask"),l=dataProperties(i,"bid"),c=e(),o=React.createElement(dataCells,{nameList:n,askList:r,bidList:l,spreadList:c});console.log(a),ReactDOM.render(o,document.getElementById("data-table"))}}}function gatherInstruments(){var e=new XMLHttpRequest;e.onerror=function(){console.log("gather error")},e.onload=function(){var t=JSON.parse(e.responseText),s=t[0].instrument;(function(){for(var e=1;e<t.length;e++)s+="%2C"+t[e].instrument})();postData(s,t)},e.open("GET","/instruments",!0),e.send()}function switchPages(e){e.preventDefault();for(var t=(document.getElementById("navigation"),document.getElementsByClassName("page")),s=0;s<t.length;s++)e.target.getAttribute("data-page")===t[s].getAttribute("data-page")?(t[s].classList.add("show"),t[s].classList.remove("hidden")):(t[s].classList.remove("show"),t[s].classList.add("hidden"))}function highlightToggle(){$(document).ready(function(){$("#history-table").slideToggle()})}function filterByName(e){var t=document.getElementsByClassName("cell");_.each(t,function(t){"hideAll"===e?console.log(e):t.getAttribute("data-filter")===e&&t.classList.toggle("hidden")})}function deselectAll(){console.log("yas")}function getHistory(e,t){function s(){i&&(i.textContent=""),document.getElementById("graph")||r.appendChild(n)}var a=new XMLHttpRequest,i=document.getElementById("history-help"),n=document.createElement("img"),r=document.getElementById("history-table");n.setAttribute("id","history-load-icon"),n.setAttribute("src","../images/loading.gif"),a.addEventListener("loadstart",s),a.open("POST","/instruments/history"),a.send(e),a.onload=function(){var e=React.createElement(historyData,{displayName:t});responseObject=JSON.parse(a.responseText),dateList=responseObject.candles,ReactDOM.render(e,document.getElementById("history-table")),drawChart(dateList)}}function drawChart(e){var t=function(){for(var t=[],s=0;s<e.length;s++)t.push([e[s].time.slice(0,10),e[s].lowBid,e[s].openBid,e[s].closeBid,e[s].highBid]);return t}(),s=google.visualization.arrayToDataTable(t,!0),a={legend:"none",height:500,backgroundColor:{fill:"none"},width:2200,fallingColor:{strokeWidth:0,color:"#a52714"},risingColor:{strokeWidth:0,color:"#0f9d58"}},i=new google.visualization.CandlestickChart(document.getElementById("graph"));i.draw(s,a)}var cell=React.createClass({openHistory:function(){var e=this.props.name,t=e.slice(0,3),s=e.slice(4,8),a=t+"_"+s;getHistory(a,e)},highlight:function(e){var t=document.getElementById("history-table").getAttribute("style"),s=document.getElementsByClassName("select-box");_.each(s,function(e){e.classList.remove("highlight")}),this.selectedCell.classList.add("highlight"),"display: block;"!==t&&highlightToggle(),this.openHistory()},componentWillReceiveProps:function(e){var t=e.spread,s=this.props.spread,a=this.spreadCell;s!==t&&s>t?(a.classList.remove("show-decrease"),a.classList.add("show-increase"),a.classList.remove("show-no-change")):s!==t&&t>s?(a.classList.remove("sh√üow-increase"),a.classList.add("show-decrease"),a.classList.remove("show-no-change")):(a.classList.add("show-no-change"),a.classList.remove("show-increase"),a.classList.remove("show-decrease"))},propTypes:{displayName:React.PropTypes.string,bid:React.PropTypes.number,ask:React.PropTypes.number,spread:React.PropTypes.number},render:function(){var e=this,t=this.props.name.slice(0,3),s=this.props.name.slice(4,8);return React.DOM.div({className:"select-box",ref:function(t){return e.selectedCell=t},onClick:this.openHistory,onClick:this.highlight},React.DOM.div({className:"flags"},React.DOM.div({className:t.toLowerCase()}),React.DOM.div({className:s.toLowerCase()})),React.DOM.div({className:"display-name"},this.props.name),React.DOM.div({className:"bid-ask-prices"},React.DOM.div({className:"bid-price"},"bid: "+this.props.bid),React.DOM.div({className:"ask-price"},"ask: "+this.props.ask)),React.DOM.div({className:"spread",ref:function(t){return e.spreadCell=t}},this.props.spread))}}),dataCells=React.createClass({getInitialState:function(){return{filterStates:{eurChecked:!0,usdChecked:!0,gbpChecked:!0,chfChecked:!0,audChecked:!0,cadChecked:!0,nzdChecked:!0,stateChange:function(e){this[e]=!this[e],console.log(this[e])}}}},filter:function(e){var t=e.target.getAttribute("id"),s=t.slice(0,3),a=s+"Checked";this.state.filterStates.stateChange(a),(this.state.filterStates[a]=!1)?this.state.filterStates[a]=!0:this.state.filterStates.stateChange(a),filterByName(s)},deselect:function(e){},render:function(){var e=this.props.bidList,t=this.props.bidList,s=this.props.spreadList,a=this.props.nameList.map(function(a,i){var n=React.createElement(cell,{name:a.displayName,bid:e[i],ask:t[i],spread:s[i]});return React.createElement("div",{className:"cell",key:i,"data-filter":a.displayName.slice(0,3).toLowerCase()},n)});return React.createElement("div",{id:"cell-list"},React.DOM.div({id:"filters"},React.DOM.label({},React.DOM.input({type:"checkbox",id:"eur-filter",onChange:this.filter,checked:this.state.filterStates.eurChecked}),React.DOM.span({},"EUR")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"usd-filter",onChange:this.filter,defaultChecked:this.state.filterStates}),React.DOM.span({},"USD")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"gbp-filter",onChange:this.filter,defaultChecked:this.state.filterStates}),React.DOM.span({},"GBP")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"chf-filter",onChange:this.filter,defaultChecked:this.state.filterStates}),React.DOM.span({},"CHF")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"aud-filter",onChange:this.filter,defaultChecked:this.state.filterStates}),React.DOM.span({},"AUD")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"cad-filter",onChange:this.filter,defaultChecked:this.state.filterStates}),React.DOM.span({},"CAD")),React.DOM.label({},React.DOM.input({type:"checkbox",id:"nzd-filter",onChange:this.filter,defaultChecked:this.state.filterStates}),React.DOM.span({},"NZD")),React.DOM.input({id:"deselect",type:"button",value:"Deselect All",onClick:this.deselect})),a)}});setInterval(gatherInstruments,2e3),$(document).ready(function(){$("#history-button").click(function(){$("#history-table").slideToggle()})});var eachCell=document.getElementsByClassName("cell");console.log(eachCell);var historyData=React.createClass({propTypes:{displayName:React.PropTypes.string},render:function(){var e=this.props.displayName.slice(0,3),t=this.props.displayName.slice(4,8);return React.DOM.div({id:"history-info"},React.DOM.h3({className:"history-instrument"},this.props.displayName),React.DOM.div({className:"graph-flag"},React.DOM.div({className:e.toLowerCase()}),React.DOM.div({className:t.toLowerCase()})),React.DOM.div({id:"graph"}))}});